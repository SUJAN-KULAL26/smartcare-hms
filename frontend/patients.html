<!DOCTYPE html>
<html>
<head>
  <title>SmartCare HMS - Patients</title>

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin:0;
      font-family:'Segoe UI',sans-serif;
      background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
      min-height:100vh;
      color:white;
      position:relative;
      overflow-x:hidden;
    }

    /* Background glow */
    body::before, body::after {
      content:"";
      position:absolute;
      width:400px;
      height:400px;
      border-radius:50%;
      filter:blur(150px);
      z-index:-1;
    }

    body::before {
      background: rgba(0,123,255,0.3);
      top:-150px;
      left:-150px;
    }

    body::after {
      background: rgba(0,255,255,0.2);
      bottom:-150px;
      right:-150px;
    }

    /* NAVBAR */
    .navbar {
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(12px);
      padding:15px 30px;
      display:flex;
      gap:25px;
      align-items:center;
      border-bottom:1px solid rgba(255,255,255,0.15);
    }

    .navbar a {
      color:#ddd;
      text-decoration:none;
      font-weight:500;
      transition:0.3s;
    }

    .navbar a:hover {
      color:#00c6ff;
    }

    .navbar button {
      margin-left:auto;
      background: linear-gradient(90deg,#00c6ff,#0072ff);
      border:none;
      padding:8px 18px;
      border-radius:25px;
      color:white;
      cursor:pointer;
      font-weight:bold;
    }

    .container {
      padding:40px;
      max-width:1200px;
      margin:auto;
    }

    h3 {
      margin-bottom:20px;
      color:#ddd;
    }

    /* GLASS CARD */
    .card {
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(15px);
      padding:25px;
      border-radius:20px;
      box-shadow:0 20px 40px rgba(0,0,0,0.4);
      border:1px solid rgba(255,255,255,0.15);
      margin-bottom:30px;
    }

    /* FORM */
    .form-row {
      display:flex;
      gap:15px;
      flex-wrap:wrap;
    }

    input, select {
      padding:12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.2);
  background: rgba(255,255,255,0.08);
  color:rgb(1, 16, 17);
  flex:1;
  min-width:160px;
  outline:none;
  transition:0.3s;
    }

    input:focus, select:focus {
      border-color:#00c6ff;
    }

    .primary-btn {
      background: linear-gradient(90deg,#00c6ff,#0072ff);
      border:none;
      border-radius:25px;
      padding:12px 25px;
      cursor:pointer;
      color:white;
      font-weight:bold;
      transition:0.3s;
    }

    .primary-btn:hover {
      transform:translateY(-3px);
    }

    .delete-btn {
      background:#dc3545;
      border:none;
      padding:6px 12px;
      border-radius:8px;
      color:white;
      cursor:pointer;
    }

    /* TABLE */
    table {
      width:100%;
      border-collapse:collapse;
    }

    th, td {
      padding:14px;
      text-align:center;
    }

    th {
      background: rgba(255,255,255,0.15);
      color:#ddd;
    }

    tr {
      border-bottom:1px solid rgba(255,255,255,0.1);
    }

    tr:hover {
      background: rgba(255,255,255,0.05);
    }

    td button {
      margin:3px;
      padding:6px 12px;
      border-radius:8px;
      border:none;
      cursor:pointer;
    }

  </style>
</head>

<body>

<div class="navbar">
  <a href="/dashboard.html">Dashboard</a>
  <a href="/patients.html">Patients</a>
  <a href="/doctors.html">Doctors</a>
  <a href="/appointments.html">Appointments</a>
  <a href="/billing.html">Billing</a>
  <a href="/reports.html">Reports</a>
  <button onclick="logout()">Logout</button>
</div>

<div class="container">

  <div class="card">
    <h3>Add / Update Patient</h3>
    <div class="form-row">
      <input type="text" id="pname" placeholder="Name">
      <input type="number" id="page" placeholder="Age">
      <select id="pgender">
        <option value="">Gender</option>
        <option>Male</option>
        <option>Female</option>
        <option>Other</option>
      </select>
      <input type="text" id="pcontact" placeholder="Contact">
      <button class="primary-btn" onclick="handlePatient()">Save</button>
    </div>
  </div>

  <div class="card">
    <h3>Patient List</h3>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Age</th>
          <th>Gender</th>
          <th>Contact</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="patientTable"></tbody>
    </table>
  </div>

</div>

<script>
document.addEventListener("DOMContentLoaded", function(){

let editingPatientId=null;
const token=localStorage.getItem("token");
const API="https://smartcare-hms-backend.onrender.com/api";

if(!token){
  window.location.href="/";
  return;
}

async function loadPatients(){
  const res=await fetch(`${API}/patients`,{
    headers:{ Authorization:"Bearer "+token }
  });

  const data=await res.json();
  const table=document.getElementById("patientTable");
  table.innerHTML="";

  if(!Array.isArray(data)){
    table.innerHTML="<tr><td colspan='5'>No patients found</td></tr>";
    return;
  }

  data.forEach(p=>{
    table.innerHTML+=`
      <tr>
        <td>${p.name}</td>
        <td>${p.age}</td>
        <td>${p.gender}</td>
        <td>${p.contact}</td>
        <td>
          <button onclick="editPatient('${p._id}','${p.name}','${p.age}','${p.gender}','${p.contact}')">Edit</button>
          <button class="delete-btn" onclick="deletePatient('${p._id}')">Delete</button>
        </td>
      </tr>`;
  });
}

window.editPatient=function(id,name,age,gender,contact){
  editingPatientId=id;
  pname.value=name;
  page.value=age;
  pgender.value=gender;
  pcontact.value=contact;
};

window.handlePatient=async function(){
  const body={
    name:pname.value,
    age:page.value,
    gender:pgender.value,
    contact:pcontact.value
  };

  if(editingPatientId){
    await fetch(`${API}/patients/${editingPatientId}`,{
      method:"PUT",
      headers:{
        "Content-Type":"application/json",
        Authorization:"Bearer "+token
      },
      body:JSON.stringify(body)
    });
    editingPatientId=null;
  } else {
    await fetch(`${API}/patients`,{
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        Authorization:"Bearer "+token
      },
      body:JSON.stringify(body)
    });
  }

  loadPatients();
};

window.deletePatient=async function(id){
  await fetch(`${API}/patients/${id}`,{
    method:"DELETE",
    headers:{ Authorization:"Bearer "+token }
  });
  loadPatients();
};

window.logout=function(){
  localStorage.clear();
  window.location.href="/";
};

loadPatients();

});
</script>

</body>
</html>